# RAG-Anything 使用指南

## 📋 目录

1. [项目简介](#项目简介)
2. [环境准备](#环境准备)
3. [安装步骤](#安装步骤)
4. [快速开始](#快速开始)
5. [详细使用](#详细使用)
6. [高级功能](#高级功能)
7. [常见问题](#常见问题)
8. [示例代码](#示例代码)

## 🎯 项目简介

RAG-Anything 是一个基于 LightRAG 的多模态文档处理 RAG 系统，具备以下核心能力：

- **🔄 端到端处理流水线**：从文档解析到知识图谱构建的完整流程
- **📄 多格式支持**：PDF、Word、PowerPoint、图片、文本等多种格式
- **🧠 智能解析**：使用 MinerU 和 Docling 进行高质量文档解析
- **🔍 多模态查询**：支持文本和图像的混合查询
- **📊 知识图谱**：自动构建和维护知识图谱以增强检索效果

## 🛠️ 环境准备

### 系统要求

- Python 3.8+
- macOS / Linux / Windows
- 至少 4GB 可用内存
- 稳定的网络连接（用于下载模型和 API 调用）

### API 密钥准备

#### 选择 API 供应商

RAG-Anything 支持多种 API 供应商，你可以根据需要选择：

**推荐供应商：**
- **DeepSeek** ⭐ - 性价比最高，中文能力强
- **OpenAI** - 最新模型，稳定可靠
- **SiliconFlow** - 开源模型，价格便宜
- **Kimi** - 超长上下文，适合长文档
- **智谱AI** - 国产优秀模型
- **通义千问** - 阿里云企业级服务

详细配置请参考：[API供应商配置指南.md](./API供应商配置指南.md)

#### 获取 API 密钥

根据选择的供应商获取对应的 API Key：

1. **DeepSeek**（推荐）
   - 访问 [DeepSeek Platform](https://platform.deepseek.com/)
   - 注册账号并获取 API Key
   - 新用户有免费额度

2. **OpenAI**
   - 访问 [OpenAI Platform](https://platform.openai.com/)
   - 创建账户并获取 API 密钥

3. **其他供应商**
   - 参考 [API供应商配置指南.md](./API供应商配置指南.md) 获取详细信息

## 📦 安装步骤

### 步骤 1：克隆项目（如果从源码安装）

```bash
git clone https://github.com/HKUDS/RAG-Anything.git
cd RAG-Anything
```

### 步骤 2：安装依赖

#### 选项 A：从 PyPI 安装（推荐）

```bash
# 基础安装
pip install raganything

# 完整安装（包含所有可选功能）
pip install 'raganything[all]'

# 按需安装
pip install 'raganything[image]'      # 图像格式支持
pip install 'raganything[text]'       # 文本文件处理
pip install 'raganything[image,text]' # 多个功能
```

#### 选项 B：从源码安装

```bash
pip install -e .
# 或者包含可选依赖
pip install -e '.[all]'
```

### 步骤 3：安装 LibreOffice（处理 Office 文档）

```bash
# macOS
brew install --cask libreoffice

# Ubuntu/Debian
sudo apt-get install libreoffice

# CentOS/RHEL
sudo yum install libreoffice

# Windows
# 从官网下载安装包：https://www.libreoffice.org/download/download/
```

### 步骤 4：验证安装

```bash
# 检查 RAGAnything
python -c "from raganything import RAGAnything; print('✅ RAGAnything 安装成功')"

# 检查 MinerU
mineru --version
```

## 🚀 快速开始

### 步骤 1：配置环境变量

项目已为你创建了 `.env` 文件模板，请编辑其中的配置：

```bash
# 编辑 .env 文件
vim .env  # 或使用你喜欢的编辑器
```

**必需配置：**

```env
# OpenAI API 配置
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_BASE_URL=https://api.openai.com/v1
```

### 步骤 2：运行快速入门示例

```bash
python quick_start.py
```

这个脚本会：
1. 检查你的环境配置
2. 创建一个示例文档（如果没有测试文档）
3. 演示文档处理和查询流程

### 步骤 3：尝试自己的文档

将你的文档（PDF、Word、PowerPoint 等）放在项目目录中，然后重新运行快速入门脚本。

## 📖 详细使用

### 基本使用流程

```python
import asyncio
from raganything import RAGAnything, RAGAnythingConfig
from lightrag.llm.openai import openai_complete_if_cache, openai_embed
from lightrag.utils import EmbeddingFunc

async def main():
    # 1. 创建配置
    config = RAGAnythingConfig(
        working_dir="./rag_storage",
        parser="mineru",  # 或 "docling"
        parse_method="auto",  # "auto", "ocr", "txt"
        enable_image_processing=True,
        enable_table_processing=True,
        enable_equation_processing=True,
    )
    
    # 2. 定义模型函数
    def llm_model_func(prompt, **kwargs):
        return openai_complete_if_cache(
            "gpt-4o-mini", prompt, api_key="your-api-key", **kwargs
        )
    
    def vision_model_func(prompt, **kwargs):
        return openai_complete_if_cache(
            "gpt-4o", prompt, api_key="your-api-key", **kwargs
        )
    
    embedding_func = EmbeddingFunc(
        embedding_dim=3072,
        max_token_size=8192,
        func=lambda texts: openai_embed(
            texts, model="text-embedding-3-large", api_key="your-api-key"
        ),
    )
    
    # 3. 初始化 RAGAnything
    rag = RAGAnything(
        config=config,
        llm_model_func=llm_model_func,
        vision_model_func=vision_model_func,
        embedding_func=embedding_func,
    )
    
    # 4. 处理文档
    await rag.process_document_complete(
        file_path="path/to/your/document.pdf",
        output_dir="./output",
        parse_method="auto"
    )
    
    # 5. 查询
    result = await rag.aquery(
        query="文档的主要内容是什么？",
        mode="hybrid"  # "naive", "local", "global", "hybrid"
    )
    print(result)

asyncio.run(main())
```

### 配置选项详解

#### RAGAnythingConfig 参数

- `working_dir`: RAG 存储目录
- `parser`: 解析器选择（"mineru" 或 "docling"）
- `parse_method`: 解析方法（"auto", "ocr", "txt"）
- `enable_image_processing`: 是否启用图像处理
- `enable_table_processing`: 是否启用表格处理
- `enable_equation_processing`: 是否启用公式处理

#### 查询模式

- `naive`: 简单向量检索
- `local`: 局部图谱检索
- `global`: 全局图谱检索
- `hybrid`: 混合检索（推荐）

## 🔥 高级功能

### 1. 批处理

```python
# 查看 examples/batch_processing_example.py
await rag.batch_process_documents(
    file_paths=["doc1.pdf", "doc2.docx", "doc3.pptx"],
    output_dir="./batch_output",
    batch_size=5,
    concurrency=3
)
```

### 2. 多模态查询

```python
# 查看 examples/modalprocessors_example.py
result = await rag.aquery_with_multimodal(
    query="解释这个图表的含义",
    multimodal_content={
        "images": ["chart.png"],
        "tables": ["data.csv"]
    }
)
```

### 3. 自定义处理器

```python
# 查看 examples/enhanced_markdown_example.py
from raganything.processors import CustomProcessor

class MyProcessor(CustomProcessor):
    def process(self, content):
        # 自定义处理逻辑
        return processed_content
```

## ❓ 常见问题

### Q1: 安装时出现依赖冲突怎么办？

**A:** 这是正常现象，Python 生态系统中的依赖冲突很常见。只要核心功能能正常使用即可。如果遇到严重问题，建议使用虚拟环境：

```bash
python -m venv rag_env
source rag_env/bin/activate  # Linux/macOS
# 或 rag_env\Scripts\activate  # Windows
pip install 'raganything[all]'
```

### Q2: API 调用失败怎么办？

**A:** 检查以下几点：
1. API 密钥是否正确
2. 网络连接是否正常
3. API 配额是否充足
4. Base URL 是否正确

### Q3: 文档解析失败怎么办？

**A:** 尝试以下解决方案：
1. 确认文档格式是否支持
2. 检查文档是否损坏
3. 尝试不同的解析方法（auto/ocr/txt）
4. 确认 LibreOffice 已正确安装

### Q4: 内存不足怎么办？

**A:** 
1. 减少批处理大小
2. 降低并发数
3. 分批处理大文档
4. 增加系统内存

### Q5: 如何处理中文文档？

**A:** RAG-Anything 原生支持中文，确保：
1. 文档编码正确
2. 使用支持中文的模型
3. 系统字体支持中文显示

## 📚 示例代码

项目提供了丰富的示例代码，位于 `examples/` 目录：

- `raganything_example.py`: 基础使用示例
- `batch_processing_example.py`: 批处理示例
- `modalprocessors_example.py`: 多模态处理示例
- `enhanced_markdown_example.py`: 增强 Markdown 处理
- `insert_content_list_example.py`: 内容列表插入示例

### 运行示例

```bash
# 运行基础示例
python examples/raganything_example.py --file_path your_document.pdf

# 运行批处理示例
python examples/batch_processing_example.py

# 运行多模态示例
python examples/modalprocessors_example.py
```

## 🎯 下一步

1. **探索更多功能**：查看 `examples/` 目录中的示例
2. **自定义配置**：根据需求调整 `.env` 文件
3. **集成到项目**：将 RAG-Anything 集成到你的应用中
4. **贡献代码**：参与开源项目开发

## 📞 获取帮助

- **GitHub Issues**: [提交问题](https://github.com/HKUDS/RAG-Anything/issues)
- **文档**: [查看完整文档](https://github.com/HKUDS/RAG-Anything)
- **示例**: 参考 `examples/` 目录

---

🎉 **恭喜！你已经掌握了 RAG-Anything 的基本使用方法。开始你的多模态 RAG 之旅吧！**